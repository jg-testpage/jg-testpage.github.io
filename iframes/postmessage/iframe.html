<!DOCTYPE html>
<head>
  <script>

    var onsite = true // need to verify it to avoid registering useless listeners
    if (onsite) {
      const MESSAGE_EARLY_DATA_EXCHANGE = 'early_data_exchange'
      const MESSAGE_TARGET_ORIGIN = 'https://jg-testpage.github.io'

      function onNeonFirstMessage(event) {
        if (event.origin === MESSAGE_TARGET_ORIGIN) {
          try {
            let json = JSON.parse(event.data)
            if (json.messageId === MESSAGE_EARLY_DATA_EXCHANGE) {
              const neonData = json.payload
              console.log("child: got early payload", neonData)
            }
          } catch (e) {
            console.log("child: failed at parsing the payload from parent!")
          }
          window.removeEventListener('message', onNeonFirstMessage);
        }
      }
      window.addEventListener('message', onNeonFirstMessage)

      console.log("child: sending 'early_data_exchange'")
      window.parent.postMessage(MESSAGE_EARLY_DATA_EXCHANGE, MESSAGE_TARGET_ORIGIN)
    }
  </script>
</head>